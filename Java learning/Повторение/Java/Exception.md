# Структура Exception
![[Pasted image 20250818142741.png]]
# Error

**`Error`** — это серьезные проблемы, происходящие на уровне JVM, которые приложение не должно пытаться обрабатывать. Они сигнализируют о сбоях, не связанных с логикой программы, например, о нехватке ресурсов.
- `OutOfMemoryError` (OOM): Возникает, когда JVM не может выделить память для нового объекта. Часто свидетельствует об утечке памяти.
- `StackOverflowError`: Происходит при переполнении стека вызовов, как правило, из-за бесконечной рекурсии или очень глубоких вызовов методов.
# Проверяемые (Checked Exceptions)

Это исключения, которые **компилятор заставляет вас обрабатывать**. Если метод может выбросить такое исключение, вы обязаны либо обернуть его вызов в блок `try-catch`, либо объявить это исключение в сигнатуре метода с помощью ключевого слова `throws`.

Эти исключения наследуются от класса `Exception`, но **не** являются наследниками `RuntimeException`. Они обычно представляют собой ожидаемые ошибки, которые могут возникнуть во время выполнения и от которых программа может восстановиться (например, файл не найден).

**Примеры:** `IOException`, `SQLException`, `FileNotFoundException`.
# Непроверяемые (Unchecked Exceptions)

Это исключения, которые **не требуют обязательной обработки**. Компилятор не будет проверять, обработали вы их или нет. Как правило, они указывают на ошибки в логике программы (баги).

Все непроверяемые исключения являются наследниками класса **`RuntimeException`**. К ним также относятся и ошибки типа `Error`.

**Примеры:** `NullPointerException`, `ArrayIndexOutOfBoundsException`, `IllegalArgumentException`.
# try-catch-finally

Это фундаментальный механизм для обработки исключений в Java.
- **`try`**: В этот блок помещается код, который потенциально может выбросить исключение.
- **`catch`**: Этот блок перехватывает и обрабатывает конкретное исключение. Можно использовать несколько блоков `catch` для разных типов исключений. JVM выберет первый `catch`, который соответствует типу выброшенного исключения или его родительскому классу.
- **`finally`**: Блок, код которого **выполняется всегда**, независимо от того, было ли выброшено исключение или нет. Он сработает даже если в `try` или `catch` есть `return`. Это делает его идеальным местом для освобождения ресурсов (например, закрытия файлов или сетевых соединений).
**Важный момент**: если в блоке `finally` происходит `return` или выбрасывается исключение, оно "перекроет" любое исключение или `return` из блоков `try` и `catch`.

# try-with-resources

Это более современная и удобная конструкция для управления ресурсами. Она автоматически закрывает ресурсы после завершения работы блока `try`.
Чтобы ресурс можно было использовать в `try-with-resources`, его класс должен реализовывать интерфейс **`AutoCloseable`** (или его дочерний интерфейс `Closeable`). Ресурсы закрываются в порядке, обратном их объявлению.
# Как Java обрабатывает Exception

Когда в коде выбрасывается исключение, JVM выполняет следующие действия:
1. **Создание объекта исключения**: JVM создает объект соответствующего класса исключения и заполняет его информацией о состоянии программы в момент ошибки, включая трассировку стека (stack trace).
2. **Поиск обработчика**: JVM начинает процесс "раскрутки стека" (stack unwinding). Она ищет подходящий обработчик (`catch` блок) для этого исключения.
3. **Использование таблицы исключений**: Для каждого метода компилятор `javac` создает специальную **таблицу исключений** в байт-коде. В этой таблице указано, какие участки кода (`try` блоки) каким обработчикам (`catch` блокам) соответствуют.
    - JVM проверяет таблицу исключений текущего метода. Если находится `catch`, соответствующий типу исключения, управление передается этому блоку.
    - Если в текущем методе обработчик не найден, метод завершается, и JVM переходит к предыдущему методу в стеке вызовов, повторяя поиск в его таблице исключений.
4. **Завершение потока**: Если JVM доходит до самого начала стека вызовов (до метода `main`) и так и не находит обработчик, то поток, в котором произошло исключение, аварийно завершается, а информация об исключении выводится в консоль.